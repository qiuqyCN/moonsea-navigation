<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/default}">

<!-- 定义子页面标题 -->
<head>
    <title>首页</title>
</head>

<!-- 定义要填充到布局中 content 片段的内容 -->
<th:block layout:fragment="content">
    <div class="min-h-screen bg-base-200 w-full">
        <!-- 搜索区域 -->
        <div class="hero px-8 py-16 mt-16 mx-auto hero-bg-image">
            <div class="hero-content w-full max-w-4xl relative z-10">
                <div class="w-full flex justify-center">
                    <div th:replace="~{fragments/search :: search-component}"></div>
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="mx-auto p-8  flex gap-6 lg:max-w-[60rem] xl:max-w-[76rem] 2xl:max-w-[92rem]">
            <!-- 侧边栏 -->
            <div id="sidebar" class="card bg-base-100 shadow-xl h-fit sticky top-24 transition-all duration-300 w-64">
                <div class="card-body p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="card-title text-lg" id="sidebarTitle">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                 stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                            </svg>
                            <span id="sidebarTitleText">分类导航</span>
                        </h2>
                        <button type="button" id="sidebarToggle" class="btn btn-ghost btn-circle"
                                title="展开/收起">
                            <svg id="toggleIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                 viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                    </div>

                    <ul class="menu menu-sm p-0 gap-3 w-full" id="categoryList">
                        <li th:each="category : ${categories}" th:attr="data-category-id=${category.id}">
                            <a th:data-tip="${category.name}" th:href="'#category-' + ${category.id}" class="tooltip flex category-link gap-3">
                                <svg th:if="${category.icon != null and #strings.startsWith(category.icon, '/images/icons/')}"
                                     class="h-4 w-4 category-icon">
                                    <use th:href="${category.icon}"></use>
                                </svg>
                                <svg th:unless="${category.icon != null and #strings.startsWith(category.icon, '/images/icons/')}"
                                     xmlns="http://www.w3.org/2000/svg"
                                     class="h-4 w-4 category-icon"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                                </svg>
                                <span class="category-name text-lg" th:text="${category.name}">分类名称</span>
                                <div class="category-actions flex gap-0.25 ml-auto" sec:authorize="isAuthenticated()" style="display: none;">
                                    <button class="btn btn-ghost btn-xs edit-category" th:attr="data-id=${category.id}"
                                            title="编辑">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
                                             viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                    </button>
                                    <button class="btn btn-ghost btn-xs text-error delete-category"
                                            th:attr="data-id=${category.id}" title="删除">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
                                             viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </a>
                        </li>
                    </ul>

                    <button class="btn btn-primary btn-sm mt-4 add-category-btn" sec:authorize="isAuthenticated()"
                            id="addCategoryBtn" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <span>添加分类</span>
                    </button>
                </div>
            </div>

            <!-- 内容区域 -->
            <div class="flex-1" id="contentArea">
                <div th:each="category : ${categories}" th:id="'category-' + ${category.id}" class="mb-12 scroll-mt-24">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-3">
                            <svg th:if="${category.icon != null and #strings.startsWith(category.icon, '/images/icons/')}"
                                 class="h-6 w-6">
                                <use th:href="${category.icon}"></use>
                            </svg>
                            <svg th:unless="${category.icon != null and #strings.startsWith(category.icon, '/images/icons/')}"
                                 xmlns="http://www.w3.org/2000/svg"
                                 class="h-6 w-6"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                            </svg>
                            <span th:text="${category.name}">分类名称</span>
                        </h2>
                        <button class="btn btn-primary btn-sm add-website-btn"
                                sec:authorize="isAuthenticated()"
                                th:attr="data-category-id=${category.id}"
                                title="添加网址"
                                style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                 stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M12 4v16m8-8H4"/>
                            </svg>
                            添加网址
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4"
                         th:attr="data-category-id=${category.id}">
                        <div th:each="website : ${category.websites}" th:attr="data-website-id=${website.id}">
                            <div class="card bg-base-100 shadow hover:shadow-xl
                            transition-all duration-200 hover:-translate-y-1 group relative dark:bg-base-200 dark:shadow-lg"
                                 th:title="${website.name} + ' - ' + ${website.description}">
                                <a th:href="${website.url}" target="_blank" class="card-body p-4">
                                    <div class="flex items-center gap-3">
                                        <div class="avatar placeholder">
                                            <div class="text-primary-content rounded-lg w-12 h-12">
                                                <img loading="lazy"
                                                     th:if="${website.logo != null and !website.logo.isEmpty()}"
                                                     th:src="${website.logo}"
                                                     th:alt="${website.name}"
                                                     class="object-cover"
                                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"/>
                                                <span class="text-3xl font-semibold"
                                                      th:text="${website.name.substring(0, 1)}">网</span>
                                            </div>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h3 class="font-semibold truncate" th:text="${website.name}">网站名称</h3>
                                            <p class="text-sm text-base-content/60 truncate"
                                               th:text="${website.description}">网站描述</p>
                                        </div>
                                    </div>
                                </a>

                                <div class="website-actions absolute top-2 right-2 hidden gap-1"
                                     sec:authorize="isAuthenticated()">
                                    <button class="btn btn-ghost btn-xs btn-circle bg-base-100/80 backdrop-blur edit-website"
                                            th:attr="data-id=${website.id}, data-category-id=${category.id}"
                                            title="编辑网址">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
                                             viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                    </button>
                                    <button class="btn btn-ghost btn-xs btn-circle bg-base-100/80 backdrop-blur text-error delete-website"
                                            th:attr="data-id=${website.id}"
                                            title="删除网址">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
                                             viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加/编辑分类模态框 -->
        <dialog id="categoryModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4" id="categoryModalTitle">添加分类</h3>
                <form id="categoryForm" class="space-y-4">
                    <input type="hidden" id="categoryId">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">分类名称</span>
                        </label>
                        <input type="text" id="categoryName" placeholder="输入分类名称" class="input input-bordered"
                               required/>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">图标路径</span>
                        </label>
                        <input type="text" id="categoryIcon" placeholder="/images/icons/chat-bubble-left-right.svg"
                               class="input input-bordered"/>
                        <label class="label">
                            <span class="label-text-alt">可选，留空使用默认图标，例如: /images/icons/chat-bubble-left-right.svg</span>
                        </label>
                    </div>
                </form>
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="categoryModal.close()">取消</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">保存</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>close</button>
            </form>
        </dialog>

        <!-- 添加/编辑网址模态框 -->
        <dialog id="websiteModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4" id="websiteModalTitle">添加网址</h3>
                <form id="websiteForm" class="space-y-4">
                    <input type="hidden" id="websiteId">
                    <input type="hidden" id="websiteCategoryId">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">网站名称</span>
                        </label>
                        <input type="text" id="websiteName" placeholder="输入网站名称" class="input input-bordered"
                               required/>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">网站URL</span>
                        </label>
                        <input type="url" id="websiteUrl" placeholder="https://example.com" class="input input-bordered"
                               required/>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">网站描述</span>
                        </label>
                        <textarea id="websiteDescription" placeholder="输入网站描述" class="textarea textarea-bordered"
                                  rows="2"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Logo URL</span>
                        </label>
                        <input type="url" id="websiteLogo" placeholder="https://example.com/logo.png"
                               class="input input-bordered"/>
                        <label class="label">
                            <span class="label-text-alt">可选，留空使用首字母</span>
                        </label>
                    </div>
                </form>
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="websiteModal.close()">取消</button>
                    <button type="button" class="btn btn-primary" id="saveWebsiteBtn">保存</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>close</button>
            </form>
        </dialog>
    </div>
</th:block>

<!-- 定义要插入到布局中 css 片段的特定 CSS -->
<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /*搜索区域背景*/
        [data-theme="light"] .hero-bg-image {
            background-image: url('/images/blury-shape-bg-light.png');
        }

        [data-theme="dark"] .hero-bg-image {
            background-image: url('/images/blury-shape-bg-dark.png');
        }
    </style>
</th:block>
<!-- 定义要插入到布局中 javascript 片段的特定 JS -->
<th:block layout:fragment="javascript">
    <!-- Sortable.js -->
    <script th:src="@{/js/Sortable.min1.15.0.js}"></script>
    <!-- 搜索功能JavaScript -->
    <th:block th:replace="~{fragments/search :: search-js}"></th:block>
    <script th:src="@{/js/index.js}"></script>
</th:block>

</html>
